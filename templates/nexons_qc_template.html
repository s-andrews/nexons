<!doctype html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">


    <style>
        .sectionhead {
            background-color: #333333;
            color: white;
            margin-top: 2em;
            margin-bottom: 1em;
            width: 90%;
            margin-left: auto;
            margin-right: auto;
        }
        #options td{
            font-family: monospace;
            text-align: left;
        }
    </style>

    <title>Nexons QC Report: %%BAMFILE%% </title>
</head>

<body>
    <div class="container-fluid text-center">
        <div class="row">
            <div class="col-md-2"></div>
            <div class="col-md-2">
                <svg width="250" height="100" viewBox="0 0 132.29166 52.916665" version="1.1" id="svg1"
                    xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg">
                    <defs id="defs1" />
                    <g id="layer1">
                        <path
                            d="M 24.451724,44.705101 H 22.16849 L 12.226907,17.330072 V 44.705101 H 9.1112432 V 7.4836242 H 11.584747 L 21.336061,34.382979 V 7.4836242 h 3.115663 z m 28.040972,-2.687557 q 0,2.687557 -2.663774,2.687557 h -7.610781 q -2.663773,0 -2.663773,-2.687557 V 24.251127 q 0,-2.687558 2.663773,-2.687558 h 7.610781 q 2.663774,0 2.663774,2.687558 v 8.324291 l -1.070266,1.117834 h -8.799966 v 8.371859 H 49.4246 v -4.233497 h 3.068096 z M 49.4246,31.172181 v -6.968622 h -6.802136 v 6.968622 z m 20.858297,13.53292 h -3.210798 l -3.900526,-9.156721 -3.948092,9.156721 h -3.115664 v -0.09513 L 61.506715,32.813255 56.440789,21.563569 h 3.210798 l 3.567554,8.490778 3.662688,-8.490778 h 3.068096 v 0.09513 l -5.065926,11.059417 z m 16.862642,-2.687557 q 0,2.687557 -2.687558,2.687557 h -7.943752 q -2.663774,0 -2.663774,-2.687557 V 24.251127 q 0,-2.687558 2.663774,-2.687558 h 7.943752 q 2.687558,0 2.687558,2.687558 z m -3.163231,-0.09513 V 24.346261 h -6.968622 v 17.576148 z m 21.619372,2.782692 h -3.16323 V 24.393829 l -6.968625,0.190269 V 44.705101 H 92.306594 V 21.563569 h 3.163231 v 0.64216 q 1.855128,-0.237837 3.734039,-0.499457 2.283236,-0.285405 3.757826,-0.285405 2.63999,0 2.63999,2.592423 z m 17.57614,-2.687557 q 0,2.687557 -2.68755,2.687557 h -7.25403 q -2.68756,0 -2.68756,-2.687557 v -5.256196 h 3.11567 v 5.208629 h 6.39781 V 37.35594 l -8.27672,-6.778352 q -1.18919,-0.951347 -1.18919,-2.473503 v -3.852958 q 0,-2.687558 2.68756,-2.687558 h 7.15889 q 2.68756,0 2.68756,2.687558 v 4.614036 h -3.0681 v -4.566469 h -6.39781 v 4.043227 l 8.34807,6.778352 q 1.1654,0.927564 1.1654,2.521072 z"
                            id="text1"
                            style="font-size:48.709px;font-family:'Agency FB';-inkscape-font-specification:'Agency FB, Normal';stroke-width:4.05907"
                            aria-label="N exons" />
                        <rect style="fill:#666666;stroke-width:0.263344" id="rect1" width="21.899748" height="9.3152132"
                            x="39.560234" y="7.4758248" />
                        <rect style="fill:#666666;stroke-width:0.192967" id="rect2" width="11.758718" height="9.3152132"
                            x="70.161438" y="7.4758248" />
                        <rect style="fill:#666666;stroke-width:0.288807" id="rect3" width="26.339529" height="9.3152132"
                            x="96.840897" y="7.4758248" />
                        <path id="path3" style="fill:none;stroke:#666666;stroke-width:1;stroke-dasharray:none"
                            d="m 61.043934,16.537914 2.387295,-4.025844 2.38731,-4.025848 2.3873,4.025848 2.38733,4.025844" />
                        <path id="path5" style="fill:none;stroke:#666666;stroke-width:1;stroke-dasharray:none"
                            d="m 81.544269,16.455791 3.91719,-4.280945 3.91726,-4.280948 3.91723,4.280948 3.91723,4.280945" />
                        <g id="g24" transform="matrix(0.75932221,0,0,0.94110391,16.36653,-14.014015)"
                            style="stroke-width:1.18295;stroke-dasharray:none">
                            <g id="g27" style="fill:#666666;stroke:#666666">
                                <path
                                    style="fill:#666666;stroke:#666666;stroke-width:2.01037;stroke-dasharray:none;stroke-opacity:1"
                                    d="M 14.345636,29.63197 V 69.141265" id="path24"
                                    transform="matrix(-1.2394,0,0,0.99999999,32.851945,8.0999999e-7)" />
                                <path
                                    style="fill:#666666;stroke:#666666;stroke-width:2.01037;stroke-dasharray:none;stroke-opacity:1"
                                    d="M 14.345636,29.63197 V 69.141265" id="path25"
                                    transform="matrix(-1.2394,0,0,0.99999999,44.151139,8.0999999e-7)" />
                                <path
                                    style="fill:#666666;stroke:#666666;stroke-width:2.01037;stroke-dasharray:none;stroke-opacity:1"
                                    d="M 14.345636,29.63197 V 69.141265" id="path10"
                                    transform="matrix(0,-1,-0.34624437,0,37.78541,46.863156)" />
                                <path
                                    style="fill:#666666;stroke:#666666;stroke-width:2.01037;stroke-dasharray:none;stroke-opacity:1"
                                    d="M 14.345636,29.63197 V 69.141265" id="path12"
                                    transform="matrix(0,-1,-0.34624437,0,37.78541,80.559777)" />
                                <path
                                    style="fill:#666666;stroke:#666666;stroke-width:2.01037;stroke-dasharray:none;stroke-opacity:1"
                                    d="M 14.345636,29.63197 V 69.141265" id="path14"
                                    transform="matrix(0,-1,-0.34624437,0,37.78541,53.60248)" />
                                <path
                                    style="fill:#666666;stroke:#666666;stroke-width:2.01037;stroke-dasharray:none;stroke-opacity:1"
                                    d="M 14.345636,29.63197 V 69.141265" id="path16"
                                    transform="matrix(0,-1,-0.34624437,0,37.78541,60.341804)" />
                                <path
                                    style="fill:#666666;stroke:#666666;stroke-width:2.01037;stroke-dasharray:none;stroke-opacity:1"
                                    d="M 14.345636,29.63197 V 69.141265" id="path18"
                                    transform="matrix(0,-1,-0.34624437,0,37.78541,67.081129)" />
                                <path
                                    style="fill:#666666;stroke:#666666;stroke-width:2.01037;stroke-dasharray:none;stroke-opacity:1"
                                    d="M 14.345636,29.63197 V 69.141265" id="path20"
                                    transform="matrix(0,-1,-0.34624437,0,37.78541,73.820453)" />
                            </g>
                        </g>
                    </g>
                </svg>
            </div>
            <div class="col-md-8 text-center align-middle">
                <h2>%%BAMFILE%% </h2>
            </div>
        </div>

        <div class="row text-center">
            <div class="col-md-12 sectionhead">
                <h2>Nexons Options</h2>
            </div>
        </div>


        <div class="row text-center">
            <div class="col-md-4"></div>
            <div class="col-md-4">
                <table id="options" class="table table-sm">
                    <tr>
                        <th>Option</th>
                        <th>Value</th>
                    </tr>

                    %%OPTIONS%%
                </table>
            </div>
        </div>

        <div class="row text-center">
            <div class="col-md-12 sectionhead">
                <h2>Read Fate</h2>
            </div>
        </div>
        <div class="row">
            <div class="col-md-2">
            </div>

            <div class="col-md-4">
                <table class="table">
                    <tbody>
                        <tr>
                            <th>Total Reads (BAM entries)</th>
                            <td>%%Total_Reads%%</td>
                        </tr>
                        <tr>
                            <th>No Alignment</th>
                            <td>%%No_Alignment%%</td>
                        </tr>
                        <tr>
                            <th>Primary Alignments</th>
                            <td>%%Primary_Alignment%%</td>
                        </tr>
                        <tr>
                            <th>Secondary Alignments</th>
                            <td>%%Secondary_Alignment%%</td>
                        </tr>                        
                    </tbody>
                </table>
            </div>
            <div class="col-md-4">
                <div style="width: 100%;" class="pt-1">
                    <canvas id="fatechart" style="width: 100%;"></canvas>
                </div>
            </div>
        </div>

        <div class="row text-center">
            <div class="col-md-12 sectionhead">
                <h2>Alignment Fate</h2>
            </div>
        </div>
        <div class="row">
            <div class="col-md-2">
            </div>

            <div class="col-md-4">
                <table class="table">
                    <tbody>
                        <tr>
                            <th>Full Transcript Match</th>
                            <td>%%Unique%%</td>
                        </tr>
                        <tr>
                            <th>Partial Unique Transcript Match</th>
                            <td>%%Partial%%</td>
                        </tr>
                        <tr>
                            <th>Unique Gene Match</th>
                            <td>%%Gene%%</td>
                        </tr>
                        <tr>
                            <th>Multi Gene Match</th>
                            <td>%%Multi_Gene%%</td>
                        </tr>
                        <tr>
                            <th>No Gene Match</th>
                            <td>%%No_Gene%%</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class="col-md-4">
                <div style="width: 100%;" class="pt-1">
                    <canvas id="alignmentchart" style="width: 100%;"></canvas>
                </div>
            </div>
        </div>

        <div class="row text-center">
            <div class="col-md-12 sectionhead">
                <h2>Read Lengths</h2>
            </div>
        </div>
        <div class="row">
            <div class="col-md-2">
            </div>

            <div class="col-md-8">
                <div style="width: 100%;" class="pt-1">
                    <canvas id="readlengthchart" style="width: 100%;"></canvas>
                </div>
            </div>
        </div>


        <div class="row text-center">
            <div class="col-md-12 sectionhead">
                <h2>Exon Match Flexibility</h2>
            </div>
        </div>

        <div class="row">
            <div class="col-md-2">
            </div>

            <div class="col-md-4">
                <h2>Inner Exon Flex</h2>
            </div>
            <div class="col-md-4">
                <h2>Transcript End Flex</h2>
            </div>
        </div>

        <div class="row">
            <div class="col-md-2">
            </div>

            <div class="col-md-4">
                <div style="width: 100%;" class="pt-1">
                    <canvas id="innerflexchart" style="width: 100%;"></canvas>
                </div>
            </div>
            <div class="col-md-4">
                <div style="width: 100%;" class="pt-1">
                    <canvas id="endflexchart" style="width: 100%;"></canvas>
                </div>
            </div>
        </div>



    </div>


    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>

    const fatedata = {
            labels: [
                'No Alignment',
                'Primary Alignment',
                'Secondary Alignments'
            ],
            datasets: [{
                label: 'Read Fate Summary',
                data: [%%No_Alignment_Raw%%,%%Primary_Alignment_Raw%%,%%Secondary_Alignment_Raw%%],
                backgroundColor: [
                    'rgb(228, 26, 28)',
                    'rgb(55, 126, 184)',
                    'rgb(77, 175, 74)'

                ],
                hoverOffset: 20
            }]
        };

        new Chart("fatechart", {
            type: "doughnut",
            data: fatedata,
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        display: true,
                        position: "bottom",
                        align: "start",
                        labels: {
                            font: {
                                size: 12
                            }
                        }
                    },
                    title: {
                        display: false
                    }
                }
            }
        });

        const alignmentdata = {
            datasets: [{
                label: 'Unique Gene Match',
                data: [%%Gene_Raw%%,%%Primary_Alignment_Raw%%-%%Gene_Raw%%],
                backgroundColor: [
                    'rgb(77, 175, 74)',
                    'rgb(100,100,100)'
                ]
            },{
                label: 'Partial Unique Transcript Match',
                data: [%%Partial_Raw%%,%%Primary_Alignment_Raw%%-%%Partial_Raw%%],
                backgroundColor: [
                    'rgb(55, 126, 184)',
                    'rgb(100,100,100)'
                ]
            },{
                label: 'Full Transcript Match',
                data: [%%Unique_Raw%%,%%Primary_Alignment_Raw%%-%%Unique_Raw%%],
                backgroundColor: [
                    'rgb(228, 26, 28)',
                    'rgb(100,100,100)'
                ]
            },{
                label: 'Multi Gene Match',
                data: [%%Multi_Gene_Raw%%,%%Primary_Alignment_Raw%%-%%Multi_Gene_Raw%%],
                backgroundColor: [
                    'rgb(152, 78, 163)',
                    'rgb(100,100,100)'
                ]
            }]
        };

        new Chart("alignmentchart", {
            type: "doughnut",
            data: alignmentdata,
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        display: true,
                        position: "bottom",
                        align: "start",
                        labels: {
                            font: {
                                size: 12
                            }
                        }
                    },
                    title: {
                        display: false
                    }
                }
            }
        });

        const readlengthdata = {
            labels: %%ReadLengthLabels%%,
            datasets: [{
                label: 'Read Lengths',
                data: %%ReadLengthData%%,
                fill: false,
                tension: 0
            }]
        };

        new Chart("readlengthchart", {
            type: "line",
            data: readlengthdata,
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        display: false
                    },
                    title: {
                        display: false
                    }
                }
            }
        });


        const innerflexdata = {
            labels: %%InnerFlexLabels%%,
            datasets: [{
                label: 'Inner Exon Mismatch Distance',
                data: %%InnerFlexData%%,
                fill: false,
                tension: 0
            }]
        };

        new Chart("innerflexchart", {
            type: "line",
            data: innerflexdata,
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        display: false
                    },
                    title: {
                        display: false
                    }
                }
            }
        });

        const endflexdata = {
            labels: %%EndFlexLabels%%,
            datasets: [{
                label: 'Transcript End Mismatch Distance',
                data: %%EndFlexData%%,
                fill: false,
                tension: 0
            }]
        };

        new Chart("endflexchart", {
            type: "line",
            data: endflexdata,
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        display: false
                    },
                    title: {
                        display: false
                    }
                }
            }
        });

</script>
</body>